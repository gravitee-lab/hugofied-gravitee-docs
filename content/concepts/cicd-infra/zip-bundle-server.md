---
title: "The Zip Bundles Downloads Server"
date: 2020-12-16T00:44:23+01:00
draft: false
nav_menu: "Standard Operations"
menu: cicd_infra
menu_index: 11
# menu:
  # developer_guide:
    # parent: 'mainmenu'
type: cicd-infra
---

# The Zip bundles Downloads Server(s) (Work in progress)

## The problem

The docker images of __Gravitee APIM__, and other Gravitee.io Products, are defined by Dockerfiles, whose docker build process makes use of two "downloads" servers :
* https://dist.gravitee.io/
* and https://download.gravitee.io/



## The Gravitee.Io Products Impacted

### Gravitee APIM

The `Dockerfile`s defined for the 4 Gravitee APIM components are :
* versioned in the https://github.com/gravitee-io/gravitee-docker repo,and in that repo :
  * Gravitee APIM Management API Dockerfiles are :
    * release image: `./images/management-api/Dockerfile`
    * nightly image: `./images/management-api/Dockerfile-nightly`
  * Gravitee APIM Management UI :
    * release image: `./images/management-api/Dockerfile`
    * nightly image: `./images/management-api/Dockerfile-nightly`
  * Gravitee APIM Portal UI :
    * release image: `./images/portal-ui/Dockerfile` (does not exist yet)
    * nightly image: `./images/portal-ui/Dockerfile-nightly`
  * Gravitee APIM Gateway :
    * release image: `./images/gateway/Dockerfile`
    * nightly image: `./images/gateway/Dockerfile-nightly`

Now, for each of those container image definition, I synthetized the _"download servers"_ usage in the table below, making clear that :
* https://dist.gravitee.io/ is used to build nightly images
* and https://download.gravitee.io/is used to build release images

Those two servers are therefore, two components of the infrastructure of the global Gravitee CICD System.

{{< tables/1/table id="sample" class="bordered" data-sample=10 >}}

| Gravitee APIM component      | nightly or release | Download(s) server(s) used          | Check this in the git repo 's master branch          |
|------------------------------|--------------------|-------------------------------------|------------------------------------------------------|
| Gravitee APIM Management API | release            | https://download.gravitee.io/       | [`./images/management-api/Dockerfile` line 21](https://github.com/gravitee-io/gravitee-docker/blob/2ba64162af7717ccbcb79025e221e997846a34ae/images/management-api/Dockerfile#L21) |
| Gravitee APIM Management API | nightly            | https://dist.gravitee.io/           | [`./images/management-api/Dockerfile-nightly` line 21](https://github.com/gravitee-io/gravitee-docker/blob/2ba64162af7717ccbcb79025e221e997846a34ae/images/management-api/Dockerfile-nightly#L21) |
| Gravitee APIM Management UI  | release            | https://download.gravitee.io/       | [`./images/management-ui/Dockerfile` ligne 26](https://github.com/gravitee-io/gravitee-docker/blob/2ba64162af7717ccbcb79025e221e997846a34ae/images/management-ui/Dockerfile#L26)  |
| Gravitee APIM Management UI  | nightly            | https://dist.gravitee.io/           | [`./images/management-ui/Dockerfile-nightly` ligne 27](https://github.com/gravitee-io/gravitee-docker/blob/2ba64162af7717ccbcb79025e221e997846a34ae/images/management-ui/Dockerfile-nightly#L27) |
| Gravitee APIM Portal UI      | release            | _(image does not exist yet)_        | _(image does not exist yet)_ |
| Gravitee APIM Portal UI      | nightly            | https://dist.gravitee.io/           | [`images/portal-ui/Dockerfile-nightly` ligne 27](https://github.com/gravitee-io/gravitee-docker/blob/2ba64162af7717ccbcb79025e221e997846a34ae/images/portal-ui/Dockerfile-nightly#L27) |
| Gravitee APIM Gateway        | release            | https://download.gravitee.io/       | [`./images/gateway/Dockerfile` line 21](https://github.com/gravitee-io/gravitee-docker/blob/2ba64162af7717ccbcb79025e221e997846a34ae/images/gateway/Dockerfile#L21) |
| Gravitee APIM Gateway        | nightly            | https://dist.gravitee.io/           | [`./images/gateway/Dockerfile-nightly` line 21](https://github.com/gravitee-io/gravitee-docker/blob/2ba64162af7717ccbcb79025e221e997846a34ae/images/gateway/Dockerfile-nightly#L21) |

{{</ tables/1/table >}}


### Gravitee Cockpit (work in progress)

The `Dockerfile`s defined for the 2 Gravitee Cockpit components are :
* versioned in the https://github.com/gravitee-io/gravitee-cockpit repo, and in that repo :
  * Gravitee Cockpit Management API Dockerfiles are :
    * release image: `./docker/management-api/Dockerfile`
    * nightly image: `./docker/management-api/Dockerfile-dev`
  * Gravitee Cockpit Management UI :
    * release image: `./docker/webui/Dockerfile`
    * nightly image: `./docker/webui/Dockerfile-dev`


Now, for each of those container image definition, I synthetized the _"download servers"_ usage in the table below, making clear that :
* https://dist.gravitee.io/ is not used, like for GRavitee API, to build nightly images : In the stead, the files generated by the repo build process, are locally used in pipelines execution, by the Docker build process.
* and that https://download.gravitee.io/ is palned to be used to build release images ofGRavitee Cockpit, when its release process will fully be implemented, similarly to Gravitee APIM.


{{< tables/1/table id="sample" class="bordered" data-sample=10 >}}

| Gravitee Cockpit component      | nightly or release | Download(s) server(s) used          | Check this in the git repo 's master branch          |
|---------------------------------|--------------------|-------------------------------------|------------------------------------------------------|
| Gravitee Cockpit Management API | nightly            | no download server used             | [`./docker/management-api/Dockerfile-dev`](https://github.com/gravitee-io/gravitee-cockpit/blob/master/docker/management-api/Dockerfile-dev) . Note that all files needed in the Docker build context are _"prepared"_ by [the `Makefile`](https://github.com/gravitee-io/gravitee-cockpit/blob/e6324d5eb5f8055708b380ce4de4c6c669c0b6bc/Makefile#L8) used [in the `deliver_nightly_cockpit` Gravitee Circle CI Orb Job](https://github.com/gravitee-io/gravitee-circleci-orbinoid/blob/develop/orb/src/jobs/deliver_nightly_cockpit.yml#L75) to build the nightly Cockpit Management API |
| Gravitee Cockpit Management API | release            | https://download.gravitee.io/       | [`./docker/management-api/Dockerfile`](https://github.com/gravitee-io/gravitee-cockpit/blob/e6324d5eb5f8055708b380ce4de4c6c669c0b6bc/docker/management-api/Dockerfile#L9) . Note that the release process of `Gravitee Cockpit` has not yet been automatized, so this `Dockerfile` is not used in any implemented CICD Process yet |
| Gravitee Cockpit Web UI         | nightly            | no download server used             | [`./docker/webui/Dockerfile-dev`](https://github.com/gravitee-io/gravitee-cockpit/blob/master/docker/webui/Dockerfile-dev) . Note that all files needed in the Docker build context are _"prepared"_ by [the `Makefile`](https://github.com/gravitee-io/gravitee-cockpit/blob/e6324d5eb5f8055708b380ce4de4c6c669c0b6bc/Makefile#L20) used [in the `deliver_nightly_cockpit` Gravitee Circle CI Orb Job](https://github.com/gravitee-io/gravitee-circleci-orbinoid/blob/develop/orb/src/jobs/deliver_nightly_cockpit.yml#L75) to build the nightly Cockpit Web UI |
| Gravitee Cockpit Web UI         | release            | https://download.gravitee.io/       | [`./docker/webui/Dockerfile`](https://github.com/gravitee-io/gravitee-cockpit/blob/e6324d5eb5f8055708b380ce4de4c6c669c0b6bc/docker/webui/Dockerfile#L29) . Note that the release process of `Gravitee Cockpit` has not yet been automatized, so this `Dockerfile` is not used in any implemented CICD Process yet |

<!--
-->
{{</ tables/1/table >}}




### Gravitee AM (coming soon)


{{< tables/1/table id="sample" class="bordered" data-sample=10 >}}

| Gravitee AM component        | nightly or release | Download(s) server(s) used          | Check this in the git repo 's master branch          |
|------------------------------|--------------------|-------------------------------------|------------------------------------------------------|
<!--
| Gravitee AM Management API | nightly            | https://dist.gravitee.io/           | [`./images/management-api/Dockerfile-nightly` line 21](https://github.com/gravitee-io/gravitee-docker/blob/2ba64162af7717ccbcb79025e221e997846a34ae/images/management-api/Dockerfile-nightly#L21) |
| Gravitee AM Management UI  | release            | https://download.gravitee.io/       | [`./images/management-ui/Dockerfile` ligne 26](https://github.com/gravitee-io/gravitee-docker/blob/2ba64162af7717ccbcb79025e221e997846a34ae/images/management-ui/Dockerfile#L26)  |
-->
{{</ tables/1/table >}}


### Gravitee AE (coming soon)

{{< tables/1/table id="sample" class="bordered" data-sample=10 >}}

| Gravitee AE component        | nightly or release | Download(s) server(s) used          | Check this in the git repo 's master branch          |
|------------------------------|--------------------|-------------------------------------|------------------------------------------------------|
<!--
| Gravitee AM Management API | nightly            | https://dist.gravitee.io/           | [`./images/management-api/Dockerfile-nightly` line 21](https://github.com/gravitee-io/gravitee-docker/blob/2ba64162af7717ccbcb79025e221e997846a34ae/images/management-api/Dockerfile-nightly#L21) |
| Gravitee AM Management UI  | release            | https://download.gravitee.io/       | [`./images/management-ui/Dockerfile` ligne 26](https://github.com/gravitee-io/gravitee-docker/blob/2ba64162af7717ccbcb79025e221e997846a34ae/images/management-ui/Dockerfile#L26)  |
-->
{{</ tables/1/table >}}


## Design Overview of the CICD System Component(s)

* https://dist.gravitee.io/
* and https://download.gravitee.io/

### Legacy

For the https://dist.gravitee.io/ :
* Apache HttpServer
* content defined by a git repo the https://github.com/gravitee-io/dist.gravitee.io


For the https://download.gravitee.io/ :
* Apache HttpServer
* content defined by a git repo the https://github.com/gravitee-io/dist.gravitee.io


### New design


* must keep the old URLs, all based on https://download.gravitee.io/
* S3 bucket based (clever cloud)
* I will add a hugo theme to browse at least main pages and to start with for the home landing page (explaining what's there, the policy about not keeping files older than ...e tc...)



## A First Quick recipe : setting up an first S3-based "Download" server with Clever Cloud




### Misc Resources

* A tutorial form Clever Cloud : https://www.clever-cloud.com/blog/features/2020/10/08/s3-directory-listing/
* advised palylist while working :
  * ["Creedence Revival Clearwater Greatest Hits (Full Album) Best Songs (HQ)"](https://www.youtube.com/watch?v=05JgKtm9ZKU)
